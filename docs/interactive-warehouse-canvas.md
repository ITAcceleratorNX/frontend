# Интерактивная схема склада (InteractiveWarehouseCanvas)

## Описание
Интерактивный компонент для визуального отображения плана склада с возможностью выбора боксов. Использует библиотеку `react-konva` для создания интерактивной canvas графики.

## Функциональность

### Визуальное отображение
- **Фоновое изображение**: INDIVIDUAL.png как основа схемы склада
- **Координатная система**: Использует данные из warehouseLayout.json для позиционирования боксов
- **Размеры canvas**: 615x1195 пикселей

### Цветовое кодирование боксов
- **Свободные боксы (VACANT)**: 
  - Основной цвет: `#fef3b2` (жёлтый)
  - При hover: `rgba(254, 243, 178, 0.9)` (более яркий жёлтый)
  - Граница: `#f59e0b` (оранжевая)
  - Курсор: `pointer` (можно кликнуть)

- **Занятые боксы (OCCUPIED)**:
  - Основной цвет: `rgba(200, 200, 200, 0.8)` (серый)
  - Граница: `#6b7280` (серая)
  - Иконка: lock.png (24x24px) по центру бокса
  - Курсор: `not-allowed`

- **Выбранный бокс**:
  - Основной цвет: `rgba(39, 54, 85, 0.7)` (темно-синий)
  - Граница: `#273655` (толщина 3px)
  - Текст: белый цвет

### Интерактивность
- **Клик по свободному боксу**: Выбор бокса и вызов callback функции
- **Hover эффекты**: Подсветка при наведении на свободные боксы
- **Отображение информации**: Название бокса и доступный объем прямо на схеме

## API компонента

### Props
```javascript
{
  storageBoxes: Array,      // Массив боксов с данными API
  onBoxSelect: Function,    // Callback при выборе бокса
  selectedStorage: Object   // Текущий выбранный бокс
}
```

### Структура storageBoxes
```javascript
[
  {
    id: number,
    name: string,           // Соответствует name в warehouseLayout.json
    storage_type: "INDIVIDUAL",
    status: "VACANT" | "OCCUPIED",
    total_volume: string,
    available_volume: string,
    height: string,
    description: string
  }
]
```

## Логика работы

### 1. Сопоставление данных
- Функция `getBoxStatus(boxName)` ищет бокс по имени в массиве storageBoxes
- Если бокс не найден в API данных, считается занятым по умолчанию

### 2. Обработка событий
- `handleBoxClick`: Обрабатывает клики только по свободным боксам
- `handleMouseEnter/Leave`: Управляет hover эффектами

### 3. Рендеринг элементов
- Прямоугольники (Rect) для визуализации боксов
- Изображения (Image) для иконок замков
- Текст (Text) для названий и объемов

## Компоненты интерфейса

### Информационная панель
Отображается под схемой при выборе бокса:
- Название выбранного бокса
- Общий и доступный объем
- Высота бокса
- Описание

### Легенда
Объясняет цветовые обозначения:
- Свободный бокс (жёлтый квадрат)
- Занятый бокс (серый квадрат с замком)
- Выбранный бокс (синий квадрат)

## Техническая реализация

### Библиотеки
- `react-konva@18.x.x` - для интерактивной canvas графики (совместима с React 18)
- `konva@9.x.x` - базовая библиотека для 2D canvas

**⚠️ Важно**: При использовании React 18, необходимо использовать react-konva версии 18.x.x. 
React-konva версии 19 совместима только с React 19.

### Загрузка ресурсов
- Асинхронная загрузка изображений с использованием `new Image()`
- Проверка загрузки через `onload` callback

### Оптимизация
- Мемоизация компонента с помощью `React.memo`
- Отключение событий для статических элементов (`listening={false}`)
- Использование refs для контроля производительности

## Интеграция
Компонент интегрирован в страницу заказа бокса (`WarehouseOrderPage`):
- Отображается только для склада "EXTRA SPACE Мега"
- Заменяет стандартный список карточек боксов
- Передает выбранный бокс в общее состояние страницы

## Будущие улучшения
- Добавление анимаций переходов
- Масштабирование и панорамирование схемы
- Поддержка мобильных устройств (touch события)
- Добавление схем для других складов 