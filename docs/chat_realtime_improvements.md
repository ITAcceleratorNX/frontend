# –£–ª—É—á—à–µ–Ω–∏—è realtime —á–∞—Ç–∞ ExtraSpace

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö**
- **–§–∞–π–ª:** `src/entities/chat/ui/ChatMessage.jsx`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ –∏–∫–æ–Ω–∫–∞ `MoreHorizontal` –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–¶–µ–ª—å:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∏–∑–∞–π–Ω—É

### 2. **–§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞**
- **–ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/features/chat/ui/ChangeManagerDialog.jsx`
- **–û–±–Ω–æ–≤–ª–µ–Ω:** `src/features/chat/ui/ManagerChatList.jsx`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API `chatApi.getManagers()`
  - –ö–Ω–æ–ø–∫–∞ "–°–º–µ–Ω–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞" –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
  - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å —Ñ–æ–ª–±—ç–∫–æ–º

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è realtime –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π**

#### 3.1 WebSocket –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–§–∞–π–ª:** `src/shared/lib/hooks/use-chat.js`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –£–±—Ä–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `sender_id` –≤ `NEW_MESSAGE`
  - –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket
  - –£–±—Ä–∞–Ω–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `sendMessage`

#### 3.2 –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **–§–∞–π–ª:** `src/entities/chat/model/store.js`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ID –≤ `addMessage`
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ `prependMessages`
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ dev —Ä–µ–∂–∏–º–µ

#### 3.3 API –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- **–§–∞–π–ª:** `src/shared/api/chatApi.js`
- **–ù–æ–≤—ã–π endpoint:** `getManagers()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### WebSocket Flow:
1. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:** –ö–ª–∏–µ–Ω—Ç ‚Üí WebSocket ‚Üí –°–µ—Ä–≤–µ—Ä
2. **–î–æ—Å—Ç–∞–≤–∫–∞:** –°–µ—Ä–≤–µ—Ä ‚Üí WebSocket ‚Üí –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞:** `handleWebSocketMessage` ‚Üí `addMessage` (—Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π)
4. **UI Update:** Store ‚Üí React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
```
ManagerChatList
‚îú‚îÄ‚îÄ ChangeManagerDialog (–Ω–æ–≤—ã–π)
‚îú‚îÄ‚îÄ PendingChatsPanel
‚îî‚îÄ‚îÄ ChatItem (–æ–±–Ω–æ–≤–ª–µ–Ω: +–∫–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
```

### API Endpoints:
```
GET /users/managers        # –°–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
PUT /chats/:id/manager     # –°–º–µ–Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **Realtime –¥–æ—Å—Ç–∞–≤–∫–∞** - —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –º–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–∞—Ç—ã
4. **UX** - —á–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∏–∫–æ–Ω–æ–∫

### üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. –û—Ç–∫—Ä—ã—Ç—å –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–º–µ–Ω—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —á–∞—Ç–µ

## üì± –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –î–µ—Å–∫—Ç–æ–ø
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞  
- ‚úÖ –í—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å/–±–µ–∑ WebSocket

## üöÄ Production Ready
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API
- –§–æ–ª–±—ç–∫ –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è debug 