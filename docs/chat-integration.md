# Интеграция чата в приложение ExtraSpace

## Обзор

Чат поддержки реализован с использованием WebSocket соединения для реального времени обмена сообщениями между пользователями("role": "USER",) и менеджерами("role": "MANAGER",).

## Компоненты

### ChatWidget
Основной компонент чата, который включает:
- WebSocket соединение с автоматическим переподключением
- Отображение истории сообщений с пагинацией
- Отправка и получение сообщений в реальном времени
- Индикаторы статуса соединения
- Быстрые действия для начала разговора

### ChatButton
Плавающая кнопка для быстрого доступа к чату:
- Может быть размещена на любой странице
- Адаптивный дизайн
- Индикатор новых сообщений

## API Endpoints

### Получение сообщений
```
GET /chats/{chatId}/messages?beforeId={id}&limit={number}
```

### Удаление сообщений
```
DELETE /chats/{chatId}/messages
```

### Назначение менеджера
```
PUT /chats/{chatId}/manager
Body: { "newManagerId": number }
```

## WebSocket Events

### Клиент -> Сервер
- `START_CHAT` - Начать новый чат
- `SEND_MESSAGE` - Отправить сообщение
- `ACCEPT_CHAT` - Принять чат (для менеджеров)"role": "MANAGER",

### Сервер -> Клиент
- `WAITING_FOR_MANAGER` - Ожидание подключения менеджера
- `CHAT_ACCEPTED` - Чат принят менеджером
- `NEW_MESSAGE` - Новое сообщение в чате
- `NEW_CHAT` - Уведомление о новом чате (для менеджеров "role": "MANAGER",)

## Использование

### Добавление чата на страницу
```jsx
import { ChatWidget } from '../../widgets';

function MyPage() {
  return (
    <div>
      <ChatWidget />
    </div>
  );
}
```

### Добавление плавающей кнопки
```jsx
import ChatButton from '../../shared/components/ChatButton';

function MyPage() {
  return (
    <div>
      {/* Контент страницы */}
      <ChatButton />
    </div>
  );
}
```

## Особенности

1. **Авторизация**: Чат доступен только авторизованным пользователям
2. **Автоматическое переподключение**: При потере соединения происходит автоматическое переподключение
3. **Адаптивный дизайн**: Интерфейс адаптируется под разные размеры экрана
4. **Реальное время**: Сообщения доставляются мгновенно через WebSocket
5. **Пагинация**: История сообщений загружается порциями для оптимизации производительности

## Конфигурация

WebSocket сервер: `wss://extraspace-backend.onrender.com`

Параметры переподключения:
- Максимум попыток: 5
- Экспоненциальная задержка: 1s, 2s, 4s, 8s, 16s
- Максимальная задержка: 30s 